<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EFACILITY TRADING</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#FFF9C4;color:#000}
header{background:#000;color:#FFF9C4;padding:15px;text-align:center}
h1,h2,h3{margin:10px 0}
.container{padding:20px;max-width:900px;margin:auto}
.hidden{display:none}
button{background:#000;color:#FFF9C4;border:none;padding:10px 20px;margin:5px;border-radius:5px;cursor:pointer}
button:hover{background:#333}
input,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:5px}
.exam-question{margin-bottom:15px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #000;padding:8px;text-align:left}
th{background:#000;color:#FFF9C4}
</style>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<header>
<h1>EFACILITY TRADING</h1>
<p>Learn Forex, Crypto, Stocks, Indices - 3-Month Training</p>
</header>

<div class="container">

<!-- Student Form -->
<div id="application">
<h2>Student Application Form</h2>
<form id="appForm">
<input type="text" id="fullname" placeholder="Full Name" required>
<input type="date" id="dob" required>
<input type="text" id="nin" placeholder="National ID Number" required>
<input type="email" id="email" placeholder="Email" required>
<input type="tel" id="phone" placeholder="Phone Number" required>
<input type="text" id="country" placeholder="Country" required>
<input type="text" id="state" placeholder="State of Origin" required>
<input type="text" id="address" placeholder="Address" required>
<select id="disability" required>
<option value="">Select Disability Status</option>
<option value="none">None</option>
<option value="disabled">Yes</option>
</select>
<select id="health" required>
<option value="">Health Issues?</option>
<option value="none">None</option>
<option value="bp">High Blood Pressure</option>
<option value="heart">Heart Disease</option>
<option value="lungs">Lungs Disease</option>
</select>
<select id="course" required>
<option value="">Select Course</option>
<option value="forex">Forex</option>
<option value="crypto">Crypto</option>
<option value="stocks">Stocks</option>
<option value="indices">Indices</option>
</select>
<label><input type="checkbox" id="accept" required> I accept to learn for 3 months</label><br>
<button type="submit">Submit & Start Exam</button>
</form>
</div>

<!-- Exam -->
<div id="exam" class="hidden">
<h2>Entrance Exam (20 Questions)</h2>
<form id="examForm"></form>
<button id="submitExamBtn">Submit Exam</button>
<p id="scoreText"></p>
</div>

<!-- Student Dashboard -->
<div id="dashboard" class="hidden">
<h2>Welcome <span id="studentName"></span></h2>
<p>Course: <span id="courseName"></span></p>
<p>ePin: <span id="epinDisplay">--</span></p>
<p>Tuition Status: <span id="tuitionStatus">Pending</span></p>
<h3>Select Tuition Payment</h3>
<select id="tuitionType">
<option value="full">Full Payment $120</option>
<option value="monthly">Monthly Payment $40</option>
</select>
<button id="payBtn">Pay Tuition</button>
<div class="whatsapp-links">
<h3>WhatsApp Group Link:</h3>
<a id="groupLink" href="#" target="_blank">Join Group</a>
</div>
<p>Other payments? Contact: <strong>08038684515</strong></p>
</div>

<!-- Admin login -->
<div id="adminLogin">
<h2>Administrator Login</h2>
<input type="email" id="adminEmail" placeholder="Email">
<input type="password" id="adminPass" placeholder="Password">
<button id="adminLoginBtn">Login</button>
<p id="adminMsg"></p>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden">
<h2>Admin Panel</h2>
<label>Filter by Course:
<select id="courseFilter">
<option value="all">All</option>
<option value="forex">Forex</option>
<option value="crypto">Crypto</option>
<option value="stocks">Stocks</option>
<option value="indices">Indices</option>
</select>
</label>
<label>Filter by Admission:
<select id="admissionFilter">
<option value="all">All</option>
<option value="pending">Pending</option>
<option value="granted">Granted</option>
</select>
</label>
<table id="studentTable">
<tr>
<th>Name</th><th>Course</th><th>Admission</th><th>Tuition</th><th>ePin</th><th>WhatsApp</th><th>Actions</th>
</tr>
</table>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDu4QJFLBHU2PSNiPIKpncPPZPM4p2-76U",
  authDomain: "efacility-trading.firebaseapp.com",
  projectId: "efacility-trading",
  storageBucket: "efacility-trading.firebasestorage.app",
  messagingSenderId: "983620967589",
  appId: "1:983620967589:web:bfdeab74d8d7f61516414c",
  measurementId: "G-VGTCJZ2JH4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentStudent = null;
const adminCredentials = {email:"ebubechichukwu8@gmail.com", password:"Ebube@123"};
const groupLinks = {
  forex:"https://chat.whatsapp.com/EMxixrh4dQd5aDe3aaZ1Yx",
  crypto:"https://chat.whatsapp.com/BbJiiGSvWwMACQLaBqn1lY",
  stocks:"https://chat.whatsapp.com/JW6QD4pBxos1QlNcq8J4jG",
  indices:"https://chat.whatsapp.com/E7i5ulbaDOK1HCCmx1jF4O"
};

// Example 20 questions
const questions=[
  {q:"What is marketing?", opts:{a:"Selling",b:"Advertising",c:"Creating value",d:"None"}, ans:"c"},
  {q:"Profit is?", opts:{a:"Revenue-Cost",b:"Cost-Revenue",c:"Revenue*Cost",d:"Revenue"}, ans:"a"},
  {q:"Investment means?", opts:{a:"Saving",b:"Spending",c:"Buying assets",d:"Borrowing"}, ans:"c"},
  {q:"Branding is?", opts:{a:"Logo only",b:"Identity & value",c:"Price",d:"Quality"}, ans:"b"},
  {q:"Customer loyalty?", opts:{a:"Repeat purchase",b:"Random buying",c:"Free stuff",d:"Discount only"}, ans:"a"},
  {q:"Market research?", opts:{a:"Guessing",b:"Survey & analysis",c:"Advertising",d:"Selling"}, ans:"b"},
  {q:"Revenue is?", opts:{a:"Cost+Profit",b:"Selling price",c:"Income",d:"All"}, ans:"c"},
  {q:"Business plan?", opts:{a:"Strategy document",b:"Invoice",c:"Report",d:"None"}, ans:"a"},
  {q:"ROI means?", opts:{a:"Return on Investment",b:"Rate of Income",c:"Revenue on Item",d:"Ratio"}, ans:"a"},
  {q:"Marketing mix?", opts:{a:"4P's",b:"3C's",c:"5S",d:"7M"}, ans:"a"},
  {q:"Supply & Demand?", opts:{a:"Forces",b:"Government",c:"Price control",d:"Cost"}, ans:"a"},
  {q:"Segmentation?", opts:{a:"Dividing market",b:"Merging",c:"Pricing",d:"Advertising"}, ans:"a"},
  {q:"Target audience?", opts:{a:"Everyone",b:"Specific group",c:"Random",d:"None"}, ans:"b"},
  {q:"Entrepreneur?", opts:{a:"Employee",b:"Business owner",c:"Investor",d:"Customer"}, ans:"b"},
  {q:"Cash flow?", opts:{a:"Money in/out",b:"Profit only",c:"Expenses only",d:"Revenue"}, ans:"a"},
  {q:"Break-even?", opts:{a:"Loss point",b:"Profit point",c:"Revenue=Cost",d:"None"}, ans:"c"},
  {q:"Pricing strategy?", opts:{a:"Fixed",b:"Dynamic",c:"Both",d:"None"}, ans:"c"},
  {q:"Advertising?", opts:{a:"Selling",b:"Promotion",c:"Tax",d:"Profit"}, ans:"b"},
  {q:"E-commerce?", opts:{a:"Online trade",b:"Retail",c:"Offline sales",d:"Logistics"}, ans:"a"},
  {q:"Stakeholders?", opts:{a:"Investors only",b:"Employees only",c:"All parties",d:"Customers only"}, ans:"c"}
];

window.onload=function(){

// --- Student Form Submit ---
document.getElementById('appForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const fullname=document.getElementById('fullname').value;
  const dob=document.getElementById('dob').value;
  const nin=document.getElementById('nin').value;
  const email=document.getElementById('email').value;
  const phone=document.getElementById('phone').value;
  const country=document.getElementById('country').value;
  const state=document.getElementById('state').value;const address=document.getElementById('address').value;
  const disability=document.getElementById('disability').value;
  const health=document.getElementById('health').value;
  const course=document.getElementById('course').value;
  const accept=document.getElementById('accept').checked;
  if(!accept){alert('You must accept 3 months training'); return;}

  try{
    const studentsSnap=await db.collection('students').get();
    const ePinNum=(studentsSnap.size +1).toString().padStart(4,'0');
    const docRef=await db.collection('students').add({
      fullname,dob,nin,email,phone,country,state,address,disability,health,course,
      examPassed:false,tuitionPaid:false,admissionGranted:false,epin:`EX${ePinNum}TR2025`
    });
    currentStudent=docRef.id;
    document.getElementById('application').classList.add('hidden');
    document.getElementById('exam').classList.remove('hidden');
    loadExam();
    window.scrollTo(0,0);
  }catch(err){alert(err.message);}
});

// --- Load Exam ---
function loadExam(){
  const examForm=document.getElementById('examForm');
  examForm.innerHTML='';
  questions.forEach((item,i)=>{
    const div=document.createElement('div');
    div.className='exam-question';
    div.innerHTML=`<p>${i+1}. ${item.q}</p>`+
      Object.keys(item.opts).map(k=>`<label><input type="radio" name="q${i}" value="${k}"> ${item.opts[k]}</label>`).join('<br>');
    examForm.appendChild(div);
  });
}

// --- Submit Exam ---
document.getElementById('submitExamBtn').addEventListener('click', async ()=>{
  let score=0;
  questions.forEach((q,i)=>{
    const ans=document.querySelector(`input[name="q${i}"]:checked`);
    if(ans && ans.value===q.ans) score++;
  });
  const passed = score >= 8;
  document.getElementById('scoreText').textContent=`You scored ${score}/20. ${passed?'Admission Granted!':'Admission Denied!'}`;
  await db.collection('students').doc(currentStudent).update({ examPassed: passed, admissionGranted: passed });
  if(passed){
    document.getElementById('exam').classList.add('hidden');
    showDashboard();
  }
});

// --- Show Student Dashboard ---
async function showDashboard(){
  const doc=await db.collection('students').doc(currentStudent).get();
  const data=doc.data();
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('studentName').textContent=data.fullname;
  document.getElementById('courseName').textContent=data.course;
  document.getElementById('epinDisplay').textContent=data.epin;
  document.getElementById('tuitionStatus').textContent=data.tuitionPaid?'Paid':'Pending';
  document.getElementById('groupLink').href=groupLinks[data.course];
}

// --- Pay Tuition ---
document.getElementById('payBtn').addEventListener('click', async ()=>{
  const tuitionType=document.getElementById('tuitionType').value;
  const doc=await db.collection('students').doc(currentStudent).get();
  const student=doc.data();
  const amount = tuitionType==='full'?12000:4000;
  const handler = PaystackPop.setup({
    key: 'pk_live_dcd7822423a68079dc1b51b8d531210c6d33d821',
    email: student.email,
    amount: amount,
    currency: 'USD',
    callback: async function(response){
      await db.collection('students').doc(currentStudent).update({ tuitionPaid:true, tuitionType });
      document.getElementById('tuitionStatus').textContent='Paid';
      alert(`Payment successful!\nYour ePin: ${student.epin}\nWhatsApp link: ${groupLinks[student.course]}`);
    },
    onClose: function(){ alert('Payment cancelled'); }
  });
  handler.openIframe();
});

// --- Admin Login ---
document.getElementById('adminLoginBtn').addEventListener('click', ()=>{
  const email=document.getElementById('adminEmail').value;
  const pass=document.getElementById('adminPass').value;
  if(email===adminCredentials.email && pass===adminCredentials.password){
    showAdminPanel();
    document.getElementById('adminLogin').classList.add('hidden');
  }else{
    document.getElementById('adminMsg').textContent='Invalid credentials';
  }
});

// --- Admin Panel ---
function showAdminPanel(){
  document.getElementById('adminPanel').classList.remove('hidden');
  const courseFilter=document.getElementById('courseFilter');
  const admissionFilter=document.getElementById('admissionFilter');

  function renderTable(snapshot){
    const table=document.getElementById('studentTable');
    table.innerHTML=`<tr>
      <th>Name</th><th>Course</th><th>Admission</th><th>Tuition</th><th>ePin</th><th>WhatsApp</th><th>Actions</th>
    </tr>`;
    snapshot.forEach(doc=>{
      const s=doc.data();
      if((courseFilter.value==='all'||courseFilter.value===s.course) &&
         (admissionFilter.value==='all'||(admissionFilter.value==='pending'&&!s.admissionGranted)||(admissionFilter.value==='granted'&&s.admissionGranted))){
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${s.fullname}</td>
          <td>${s.course}</td>
          <td>${s.admissionGranted?'Granted':'Pending'}</td>
          <td>${s.tuitionPaid?'Paid':'Pending'}</td>
          <td>${s.epin}</td>
          <td><a href="${groupLinks[s.course]}" target="_blank">Link</a></td>
          <td>
            <button onclick="grantAdmission('${doc.id}')">Grant</button>
            <button onclick="markTuitionPaid('${doc.id}')">Mark Paid</button>
            <button onclick="removeStudent('${doc.id}')">Remove</button>
          </td>`;
        table.appendChild(tr);
      }
    });
  }

  db.collection('students').onSnapshot(renderTable);
  courseFilter.onchange=()=>db.collection('students').get().then(renderTable);
  admissionFilter.onchange=()=>db.collection('students').get().then(renderTable);
}

// --- Admin Actions ---
window.grantAdmission=async function(id){await db.collection('students').doc(id).update({admissionGranted:true});};
window.markTuitionPaid=async function(id){await db.collection('students').doc(id).update({tuitionPaid:true});};
window.removeStudent=async function(id){if(confirm('Remove student?'))await db.collection('students').doc(id).delete();};

}; // window.onload end
</script>
</body>
</html>
