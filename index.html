<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Efacility Trading Portal</title>
<style>
body { font-family: Arial,sans-serif; background:#fef9e7; color:#000; margin:0; padding:0; }
header { background:#000; color:#fef9e7; padding:15px; text-align:center; font-size:20px; font-weight:bold; }
section { display:none; padding:20px; }
button { background:#000; color:#fef9e7; border:none; padding:10px 20px; margin:5px; cursor:pointer; }
button:hover { background:#444; }
input, select { padding:8px; margin:5px 0; width:100%; }
.warning { color:red; font-weight:bold; }
.student-card { border:1px solid #ccc; padding:10px; margin:10px; background:#fff; }
img.screenshot { width:100%; max-width:400px; }
#progressBar { width:100%; background:#ccc; margin-bottom:10px; height:20px; border-radius:10px; overflow:hidden; }
#progress { width:0%; height:100%; background:#000; transition:width 0.3s; }
</style>
</head>
<body>
<header>Efacility Trading Institution</header>

<section id="landing" style="display:block;">
<h2>Welcome to Efacility TradingðŸ“Š</h2>
<p>3 months intensive training on Forex, Crypto, Stocks, and Indices.</p>
<button onclick="showSection('register')">Register & Start Exam</button>
<button onclick="showSection('adminLogin')">Admin Login</button>
<button onclick="showSection('studentLogin')">Student Login</button>
</section>

<section id="register">
<h2>Registration Form</h2>
<form id="regForm">
<input placeholder="Full Name" required><br>
<input placeholder="Date of Birth" required><br>
<input placeholder="National ID Number" required><br>
<input type="email" placeholder="Email" required><br>
<input type="password" placeholder="Password" required><br>
<input placeholder="Phone" required><br>
<input placeholder="Country" required><br>
<input placeholder="State of Origin" required><br>
<input placeholder="Address" required><br>
<select required>
<option value="">Select Course</option>
<option>Forex</option>
<option>Crypto</option>
<option>Stocks</option>
<option>Indices</option>
</select><br>
<button type="submit">Submit & Start Exam</button>
<button type="button" onclick="goBack('landing')">Back</button>
</form>
</section>

<section id="exam">
<h2>Admission Exam</h2>
<p class="warning">âš  Once you start, you have 10 minutes. Answers cannot be changed.</p>
<div id="progressBar"><div id="progress"></div></div>
<div id="examQuestions"></div>
<p id="timer"></p>
<button onclick="submitExam()">Submit Exam</button>
<button onclick="goBack('register')">Back</button>
</section>

<section id="payment">
<h2>Payment Page</h2>
<p>Grand Total: $<span id="grandTotal">0</span></p>
<p>Select full tuition amount:</p>
<button onclick="selectFull()">+ Full Payment</button>
<p>Pay using Paystack:</p>
<a id="payLink" href="https://paystack.com/buy/efacility-trading-mdxbai" target="_blank"><button>Pay Now</button></a>

<p>Upload payment screenshot:</p>
<input type="file" id="paymentScreenshot" accept="image/*" onchange="previewScreenshot(event)">
<img id="screenshotPreview" class="screenshot" style="display:none;"/>

<button onclick="confirmPayment()">Confirm Payment</button>
<button onclick="goBack('exam')">Back</button>
</section>

<section id="portal">
<h2>Student Portal</h2>
<p><b>Name:</b> <span id="pName"></span></p>
<p><b>Email:</b> <span id="pEmail"></span></p>
<p><b>Course:</b> <span id="pCourse"></span></p>
<p><b>E-PIN:</b> <span id="pEpin"></span></p>
<p><b>WhatsApp Group:</b> <a id="pLink" target="_blank">Join Group</a></p>
<p><b>Countdown:</b> <span id="countdown"></span></p>
<p><b>Uploaded Payment Screenshot:</b><br><img id="pScreenshot" class="screenshot" /></p>
<button onclick="goBack('landing')">Back</button>
</section>

<section id="studentLogin">
<h2>Student Login</h2>
<input type="email" id="stuEmail" placeholder="Email"><br>
<input type="password" id="stuPass" placeholder="Password"><br>
<button onclick="studentLogin()">Login</button>
<button onclick="goBack('landing')">Back</button>
</section>

<section id="adminLogin">
<h2>Admin Login</h2>
<input type="email" id="adminEmail" placeholder="Email"><br>
<input type="password" id="adminPass" placeholder="Password"><br>
<button onclick="adminLogin()">Login</button>
<button onclick="goBack('landing')">Back</button>
</section>

<section id="adminPanel">
<h2>Admin Panel</h2>
<div id="studentList"></div>
<p>Replace Payment Method URL: 
<input id="newPay" placeholder="Enter new link">
<button onclick="updatePayLink()">Update</button>
</p>
<button onclick="goBack('landing')">Back</button>
</section>

<script>
let students = [];
let currentStudent = null;
let epinCounter = 1;
let timerInterval;
let payLink="https://paystack.com/buy/efacility-trading-mdxbai";
let grandTotal=0;

const courseLinks = {
"Forex":"https://chat.whatsapp.com/EMxixrh4dQd5aDe3aaZ1Yx",
"Crypto":"https://chat.whatsapp.com/BbJiiGSvWwMACQLaBqn1lY",
"Stocks":"https://chat.whatsapp.com/JW6QD4pBxos1QlNcq8J4jG",
"Indices":"https://chat.whatsapp.com/E7i5ulbaDOK1HCCmx1jF4O"
};

const questions = [
  {q:"What is marketing?", a:"A", opts:["A. Promoting products","B. Banking","C. Fishing","D. Singing"]},
  {q:"Define business.", a:"B", opts:["A. Sleeping","B. Selling goods/services","C. Running","D. Cooking"]},
  {q:"What is profit?", a:"C", opts:["A. Loss","B. Tax","C. Revenue - Cost","D. Gift"]},
  {q:"Explain branding.", a:"D", opts:["A. Marketing strategy","B. Price","C. Cost","D. Identity & image"]},
  {q:"What is forex?", a:"A", opts:["A. Currency trading","B. Stocks","C. Crypto","D. Insurance"]},
  {q:"Define crypto.", a:"B", opts:["A. Gold","B. Digital currency","C. Bonds","D. Savings"]},
  {q:"What is stock?", a:"C", opts:["A. Market","B. Crypto","C. Share in company","D. Currency"]},
  {q:"Explain market demand.", a:"D", opts:["A. Supply","B. Profit","C. Loss","D. Customer desire"]},
  {q:"What is supply?", a:"A", opts:["A. Quantity available","B. Price","C. Loss","D. Marketing"]},
  {q:"Define sales.", a:"B", opts:["A. Tax","B. Selling products/services","C. Loss","D. Assets"]},
  {q:"What is advertising?", a:"C", opts:["A. Tax","B. Savings","C. Promotion","D. Loss"]},
  {q:"Explain competition.", a:"D", opts:["A. Supply","B. Tax","C. Advertisement","D. Rivalry"]},
  {q:"Define consumer.", a:"A", opts:["A. Buyer","B. Seller","C. Bank","D. Employee"]},
  {q:"What is investment?", a:"B", opts:["A. Spending","B. Using money to earn","C. Borrowing","D. Selling"]},
  {q:"What is trading?", a:"C", opts:["A. Sleeping","B. Saving","C. Buying & Selling","D. Watching"]},
  {q:"What is risk?", a:"D", opts:["A. Gain","B. Asset","C. Market","D. Possibility of loss"]},
  {q:"Define assets.", a:"A", opts:["A. Owned value","B. Liability","C. Debt","D. Loss"]},
  {q:"Define liabilities.", a:"B", opts:["A. Profit","B. Debt","C. Asset","D. Cash"]},
  {q:"What is ROI?", a:"C", opts:["A. Loss","B. Asset","C. Return on Investment","D. Tax"]},
  {q:"What is entrepreneurship?", a:"D", opts:["A. Employment","B. Salary","C. Banking","D. Business creation"]}
];

function showSection(id){document.querySelectorAll("section").forEach(s=>s.style.display="none");document.getElementById(id).style.display="block";}

document.getElementById("regForm").onsubmit=e=>{
  e.preventDefault();
  const vals = Array.from(e.target.elements).map(i=>i.value).filter(v=>v);
  currentStudent={id:students.length+1,name:vals[0],email:vals[3],password:vals[4],phone:vals[5],course:vals[9],status:"ExamPending",epin:"",proof:"",link:"",active:false,completed:0};
  showExam();
};

function showExam(){
  showSection("exam");
  let qDiv=document.getElementById("examQuestions"); qDiv.innerHTML="";
  questions.forEach((q,i)=>{
    qDiv.innerHTML+=`<div class="student-card">
      <p><b>Question ${i+1}:</b> ${q.q}</p>
      ${q.opts.map(o=>`<input type="radio" name="q${i}" value="${o[0]}" onclick="updateProgress()"> ${o}`).join("<br>")}
    </div>`;
  });
  updateProgress();
  startTimer(10*60);
}

function updateProgress(){
  let answered=0;
  questions.forEach((q,i)=>{
    if(document.querySelector(`input[name="q${i}"]:checked`)) answered++;
  });
  let percent=(answered/questions.length)*100;
  document.getElementById("progress").style.width=percent+"%";
}

function startTimer(sec){
  let time=sec;
  timerInterval=setInterval(()=>{
    let m=Math.floor(time/60), s=time%60;
    document.getElementById("timer").innerText=`${m}m ${s}s left`;
    if(time--<=0){clearInterval(timerInterval);submitExam();}
  },1000);
}

function submitExam(){
  clearInterval(timerInterval);
  let score=0, completed=0;
  for(let i=0;i<questions.length;i++){
    let ans=document.querySelector(`input[name="q${i}"]:checked`);
    if(ans){completed++; if(ans.value===questions[i].a) score++;}
  }
  currentStudent.completed=completed;
  alert(`You completed ${completed} questions.\nScore: ${score}`);
  let ansStr = questions.map((q,i)=>`${i+1}. Correct answer: ${q.a}`).join("\n");
  alert("Correct Answers (10 sec display):\n"+ansStr);
  if(score>=8){currentStudent.status="Admitted"; calculateGrandTotal(); showSection("payment");}
  else{currentStudent.status="Rejected"; students.push(currentStudent); alert("Failed. Try again in 3 months."); showSection("landing");}
}

function calculateGrandTotal(){grandTotal=40+5+3; document.getElementById("grandTotal").innerText=grandTotal;}

function selectFull(){document.getElementById("grandTotal").innerText=grandTotal;}

function previewScreenshot(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      document.getElementById("screenshotPreview").src = e.target.result;
      document.getElementById("screenshotPreview").style.display = "block";
      currentStudent.proof = e.target.result;
    }
    reader.readAsDataURL(file);
  }
}

function confirmPayment(){
  if(!currentStudent.proof){
    alert("Please upload screenshot before confirming.");
    return;
  }
  currentStudent.active = true;
  currentStudent.epin = "EX" + String(epinCounter++).padStart(4,"0") + "TR2025";
  currentStudent.link = courseLinks[currentStudent.course];
  students.push(currentStudent);
  showPortal(currentStudent);
}

function showPortal(stu){
  showSection("portal");
  document.getElementById("pName").innerText=stu.name;
  document.getElementById("pEmail").innerText=stu.email;
  document.getElementById("pCourse").innerText=stu.course;
  document.getElementById("pEpin").innerText=stu.epin;
  document.getElementById("pLink").href=stu.link;
  document.getElementById("pScreenshot").src=stu.proof;
  startCountdown(3*30*24*60*60); // 3 months
}

function startCountdown(seconds){
  let time=seconds;
  setInterval(()=>{
    let d=Math.floor(time/86400), h=Math.floor(time%86400/3600), m=Math.floor(time%3600/60), s=time%60;
    document.getElementById("countdown").innerText=`${d}d ${h}h ${m}m ${s}s`;
    time--;
  },1000);
}

function studentLogin(){
  const email=document.getElementById("stuEmail").value;
  const pass=document.getElementById("stuPass").value;
  const stu = students.find(s=>s.email===email && s.password===pass);
  if(stu){showPortal(stu);}else{alert("Invalid login");}
}

function adminLogin(){
  const email=document.getElementById("adminEmail").value;
  const pass=document.getElementById("adminPass").value;
  if(email==="ebubechichukwu8@gmail.com" && pass==="Ebube@123"){showAdminPanel();}
  else{alert("Invalid admin login");}
}

function showAdminPanel(){
  showSection("adminPanel");
  let div=document.getElementById("studentList");
  div.innerHTML="";
  students.forEach(s=>{
    div.innerHTML+=`<div class="student-card">
    <p><b>Name:</b>${s.name}</p>
    <p><b>Email:</b>${s.email}</p>
    <p><b>Course:</b>${s.course}</p>
    <p><b>Status:</b>${s.status}</p>
    <p><b>Completed:</b>${s.completed} questions</p>
    <p><b>Screenshot:</b><br><img src="${s.proof}" class="screenshot"/></p>
    <button onclick="approve('${s.email}')">Approve</button>
    <button onclick="removeStudent('${s.email}')">Remove</button>
    </div>`;
  });
}

function approve(email){
  const stu=students.find(s=>s.email===email);
  if(stu){alert(`${stu.name} approved.`);}
}

function removeStudent(email){
  students = students.filter(s=>s.email!==email);
  showAdminPanel();
}

function updatePayLink(){
  let newLink=document.getElementById("newPay").value;
  if(newLink){payLink=newLink; document.getElementById("payLink").href=payLink; alert("Updated.");}
}

function goBack(id){showSection(id);}
</script>
</body>
</html>
